#载入顶部可显示信息
BARE_loading_top_display_information = {
    clear_array = topbar_menu@var:topbar_i

    add_to_array = { topbar_menu@var:topbar_i = token:BARE_top_common_categories }
    # ↓已被移到BARE_top_common_categories类别中
    # add_to_array = { topbar_menu@var:topbar_i = token:BARE_stability_factor }
    # add_to_array = { topbar_menu@var:topbar_i = token:BARE_stability_weekly }
    # add_to_array = { topbar_menu@var:topbar_i = token:BARE_defensive_war_stability_factor }
    # add_to_array = { topbar_menu@var:topbar_i = token:BARE_war_support_factor }
    # add_to_array = { topbar_menu@var:topbar_i = token:BARE_war_support_weekly }
    # add_to_array = { topbar_menu@var:topbar_i = token:BARE_casualties }
    # add_to_array = { topbar_menu@var:topbar_i = token:BARE_warscore }
    # add_to_array = { topbar_menu@var:topbar_i = token:BARE_surrender_limit }
    # add_to_array = { topbar_menu@var:topbar_i = token:BARE_surrender_progress }
    # add_to_array = { topbar_menu@var:topbar_i = token:BARE_consumer_goods }
    # add_to_array = { topbar_menu@var:topbar_i = token:BARE_min_consumer_goods }

    # add_to_array = { topbar_menu@var:topbar_i = token:WRQ_test } #这是一个测试容器

    if = {
        limit = { has_global_flag = BA_Great_Game_available Great_Game_can_be_overlord = yes }
        add_to_array = { topbar_menu@var:topbar_i = token:BARE_great_game_coin }
    }

    #国家分类   topbar_TAG_load_category
    meta_effect = {
        text = {
            topbar_[V]_load_category = yes
        }
        V = "[?ROOT.GetTag]"
    }
    BARE_remove_all_top_tags_from_tag_FLAG = yes
}

#移除所有顶部标签FLAG
BARE_remove_all_top_tags_from_tag_FLAG = {
    for_each_loop = {
        array = topbar_menu@var:topbar_i
        value = v
        meta_effect = {
            text = {
                clr_country_flag = [V]_EXPAND_OTHER_FLAG
                log = "[GetDateText]: [Root.GetName]：移除顶部分类FLAG-[V]_EXPAND_OTHER_FLAG"
            }
            V = "[?v.GetTokenKey]"
        }
    }
}

#载入
BARE_loading_top_display_information_appoint = {

    if = {
        limit = {
            BARE_top_information_category_country_triggers = no
        }
        BARE_remove_all_top_tags_from_tag_FLAG = yes
        remove_from_array = { array = ROOT.topbar_array index = topbar_i }
        add_to_array = { array = ROOT.topbar_array value = topbar_menu_v index = topbar_i }

        clear_variable = subcategory_selected
        clear_array = subcategory

        clear_array = topbar_menu@var:topbar_i
        clear_variable = selected_topbar
    }
    else = {
        meta_effect = {
            text = {
                clear_array = [V]_increasing_top_array
                [V]_expand_other = yes
                #移除操作
                if = {
                    limit = {
                        has_country_flag = [V]_EXPAND_OTHER_FLAG
                    }
                    for_each_loop = {
                        array = [V]_increasing_top_array
                        value = v
                        remove_from_array = { topbar_menu@var:topbar_i = v }
                    }
                    clr_country_flag = [V]_EXPAND_OTHER_FLAG
                    log = "[GetDateText]: [Root.GetName]：修订顶部分类-移除-[?topbar_menu_v.GetTokenKey]"
                }
                #添加操作
                else = {
                    set_temp_variable = { temp_loading_top_display_information_appoint_index_i = topbar_menu_i }
                    add_to_temp_variable = { temp_loading_top_display_information_appoint_index_i = 1 }
                    set_country_flag = [V]_EXPAND_OTHER_FLAG
                    for_each_loop = {
                        array = [V]_increasing_top_array
                        value = v
                        add_to_array = { array = topbar_menu@var:topbar_i value = v index = temp_loading_top_display_information_appoint_index_i }
                    }
                    log = "[GetDateText]: [Root.GetName]：修订顶部分类-添加-[?topbar_menu_v.GetTokenKey]"
                }
                log = "[GetDateText]: [Root.GetName]：修订顶部分类FLAG-[V]_EXPAND_OTHER_FLAG"
            }
            V = "[?topbar_menu_v.GetTokenKey]"
        }
    }
}

########要满足topbar_TAG_load_category的格式
##这是一个测试容器
topbar_TRI_load_category = {
    add_to_array = { topbar_menu@var:topbar_i = token:TRI_dynamic_topbar_category }
}

########附带的按钮要满足topbar_buttonType_[V]_click的格式
#这是一个测试容器
topbar_buttonType_BARE_great_game_coin_click = {
    if = {
        limit = {
            has_country_flag = BA_Great_Game_gui_window_visible
        }
        clr_country_flag = BA_Great_Game_gui_window_visible
    }
    else = {
        set_country_flag = BA_Great_Game_gui_window_visible
    }
}


########展开需要在对应的值后面加上_expand_other
BARE_top_common_categories_expand_other = {
    meta_effect = {
        text = {
            add_to_array = { [V]_increasing_top_array = token:BARE_stability_factor }
            add_to_array = { [V]_increasing_top_array = token:BARE_stability_weekly }
            add_to_array = { [V]_increasing_top_array = token:BARE_defensive_war_stability_factor }
            add_to_array = { [V]_increasing_top_array = token:BARE_war_support_factor }
            add_to_array = { [V]_increasing_top_array = token:BARE_war_support_weekly }
            add_to_array = { [V]_increasing_top_array = token:BARE_casualties }
            add_to_array = { [V]_increasing_top_array = token:BARE_warscore }
            add_to_array = { [V]_increasing_top_array = token:BARE_surrender_limit }
            add_to_array = { [V]_increasing_top_array = token:BARE_surrender_progress }
            add_to_array = { [V]_increasing_top_array = token:BARE_consumer_goods }
            add_to_array = { [V]_increasing_top_array = token:BARE_min_consumer_goods }
            # if = {
            #     limit = {
            #         root = { is_special_project_completed = sp:sp_nuclear_bomb }
            #     }
            #     add_to_array = { [V]_increasing_top_array = token:BARE_number_of_nuclear_bombs }
            # }

        }
        V = "[?topbar_menu_v.GetTokenKey]"
    }
}
TRI_dynamic_topbar_category_expand_other = {
    meta_effect = {
        text = {
            if = {
                limit = { has_country_flag = TRI_paranoia_system_active }
                add_to_array = { [V]_increasing_top_array = token:TRI_kirifuji_nagisa_paranoia_level }
            }
            if = {
                limit = { has_country_flag = TRI_unity_system_visible }
                add_to_array = { [V]_increasing_top_array = token:TRI_unity_data }
            }
        }
        V = "[?topbar_menu_v.GetTokenKey]"
    }
}